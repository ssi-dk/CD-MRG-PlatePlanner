
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../plate/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.4">
    
    
      
        <title>Studies - </title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#study-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="" class="md-header__button md-logo" aria-label="" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Studies
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="custom_light" data-md-color-primary="white" data-md-color-accent="green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="white" data-md-color-accent="lime"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="" class="md-nav__button md-logo" aria-label="" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../plate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plates
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Studies
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Studies
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.study" class="md-nav__link">
    <span class="md-ellipsis">
      study
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.study.Study" class="md-nav__link">
    <span class="md-ellipsis">
      Study
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Study">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.study.Study.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      __getitem__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.__iter__" class="md-nav__link">
    <span class="md-ellipsis">
      __iter__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.__next__" class="md-nav__link">
    <span class="md-ellipsis">
      __next__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      __str__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.distribute_samples_to_plates" class="md-nav__link">
    <span class="md-ellipsis">
      distribute_samples_to_plates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.load_specimen_records" class="md-nav__link">
    <span class="md-ellipsis">
      load_specimen_records
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.position_sample_within_groups" class="md-nav__link">
    <span class="md-ellipsis">
      position_sample_within_groups
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.randomize_order" class="md-nav__link">
    <span class="md-ellipsis">
      randomize_order
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.sort_records_within_groups" class="md-nav__link">
    <span class="md-ellipsis">
      sort_records_within_groups
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.to_dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      to_dataframe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.to_layout_figures" class="md-nav__link">
    <span class="md-ellipsis">
      to_layout_figures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.to_layout_lists" class="md-nav__link">
    <span class="md-ellipsis">
      to_layout_lists
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.study" class="md-nav__link">
    <span class="md-ellipsis">
      study
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.study.Study" class="md-nav__link">
    <span class="md-ellipsis">
      Study
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Study">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.study.Study.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      __getitem__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.__iter__" class="md-nav__link">
    <span class="md-ellipsis">
      __iter__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.__next__" class="md-nav__link">
    <span class="md-ellipsis">
      __next__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      __str__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.distribute_samples_to_plates" class="md-nav__link">
    <span class="md-ellipsis">
      distribute_samples_to_plates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.load_specimen_records" class="md-nav__link">
    <span class="md-ellipsis">
      load_specimen_records
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.position_sample_within_groups" class="md-nav__link">
    <span class="md-ellipsis">
      position_sample_within_groups
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.randomize_order" class="md-nav__link">
    <span class="md-ellipsis">
      randomize_order
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.sort_records_within_groups" class="md-nav__link">
    <span class="md-ellipsis">
      sort_records_within_groups
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.to_dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      to_dataframe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.to_layout_figures" class="md-nav__link">
    <span class="md-ellipsis">
      to_layout_figures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.study.Study.to_layout_lists" class="md-nav__link">
    <span class="md-ellipsis">
      to_layout_lists
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="study-documentation">Study Documentation</h1>


<div class="doc doc-object doc-module">



<a id="src.study"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.study.Study" class="doc doc-heading">
          <code>Study</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>A class to manage and manipulate study-related data, including specimen records, plate layouts, 
and sample distributions.</p>
<p>This class provides functionalities for loading specimen records, sorting and randomizing 
specimen order, distributing specimens across plates, and exporting data to various formats.</p>



  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code><span title="src.study.Study.name">name</span></code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Name of the study.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="src.study.Study.plates">plates</span></code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of Plate objects used in the study.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="src.study.Study.total_plates">total_plates</span></code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Total number of plates in the study.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="src.study.Study.specimen_records_df">specimen_records_df</span></code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pandas DataFrame holding specimen records.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="src.study.Study.records_file_path">records_file_path</span></code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Path to the file containing specimen records.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="src.study.Study._column_with_group_index">_column_with_group_index</span></code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Column name in specimen_records_df that holds group indices.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">study</span> <span class="o">=</span> <span class="n">Study</span><span class="p">(</span><span class="n">study_name</span><span class="o">=</span><span class="s2">&quot;Cancer Research&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">study</span><span class="o">.</span><span class="n">load_specimen_records</span><span class="p">(</span><span class="s2">&quot;specimens.csv&quot;</span><span class="p">,</span> <span class="n">sample_group_id_column</span><span class="o">=</span><span class="s2">&quot;GroupID&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">study</span><span class="o">.</span><span class="n">randomize_order</span><span class="p">(</span><span class="n">case_control</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">qc_plate</span> <span class="o">=</span> <span class="n">QCPlate</span><span class="p">(</span><span class="n">QC_config</span><span class="o">=</span><span class="s2">&quot;./data/plate_config_dynamic.toml&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">study</span><span class="o">.</span><span class="n">distribute_samples_to_plates</span><span class="p">()</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>src/study.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Study</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to manage and manipulate study-related data, including specimen records, plate layouts, </span>
<span class="sd">    and sample distributions.</span>

<span class="sd">    This class provides functionalities for loading specimen records, sorting and randomizing </span>
<span class="sd">    specimen order, distributing specimens across plates, and exporting data to various formats.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        name (str): Name of the study.</span>
<span class="sd">        plates (list): List of Plate objects used in the study.</span>
<span class="sd">        total_plates (int): Total number of plates in the study.</span>
<span class="sd">        specimen_records_df (DataFrame): Pandas DataFrame holding specimen records.</span>
<span class="sd">        records_file_path (str): Path to the file containing specimen records.</span>
<span class="sd">        _column_with_group_index (str): Column name in specimen_records_df that holds group indices.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; study = Study(study_name=&quot;Cancer Research&quot;)</span>
<span class="sd">        &gt;&gt;&gt; study.load_specimen_records(&quot;specimens.csv&quot;, sample_group_id_column=&quot;GroupID&quot;)</span>
<span class="sd">        &gt;&gt;&gt; study.randomize_order(case_control=True)</span>

<span class="sd">        &gt;&gt;&gt; qc_plate = QCPlate(QC_config=&quot;./data/plate_config_dynamic.toml&quot;)</span>
<span class="sd">        &gt;&gt;&gt; study.distribute_samples_to_plates()</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">_default_distribute_samples_equally</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">_batch_count</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_iter_count</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_default_seed</span> <span class="o">=</span> <span class="mi">1234</span> <span class="c1"># seed number for the random number generator in case randomization of specimens should be reproducible</span>
    <span class="n">_N_permutations</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_column_with_group_index</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a new instance of the Study class.</span>

<span class="sd">        This constructor sets up a study with a specified name. If no name is provided, a default name </span>
<span class="sd">        is generated using the current date.</span>

<span class="sd">        Args:</span>
<span class="sd">            study_name (Optional[str]): The name for the study. If None, a default name in the format </span>
<span class="sd">                &quot;Study_YYYY-MM-DD&quot; is assigned, where YYYY-MM-DD represents the current date.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; study1 = Study(study_name=&quot;Alzheimer&#39;s Research&quot;)</span>
<span class="sd">            &gt;&gt;&gt; study1.name</span>
<span class="sd">            &quot;Alzheimer&#39;s Research&quot;</span>

<span class="sd">            &gt;&gt;&gt; study2 = Study()</span>
<span class="sd">            &gt;&gt;&gt; study2.name</span>
<span class="sd">            &quot;Study_2024-01-21&quot;  # Example output; actual output will vary based on the current date.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">study_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">study_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Study_</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">study_name</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Plate</span><span class="p">,</span> <span class="n">QCPlate</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the iterator for the Study class.</span>

<span class="sd">        This method sets up the class to iterate over its plates, resetting the internal counter </span>
<span class="sd">        to zero. It allows the Study instance to be used in a loop (e.g., a for loop), </span>
<span class="sd">        facilitating iteration over its plates.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Iterator[Union[Plate, QCPlate]]: An iterator that yields either `Plate` or `QCPlate` </span>
<span class="sd">            instances, allowing the Study instance to be used in a loop.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iter_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Plate</span><span class="p">,</span> <span class="n">QCPlate</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Proceed to the next plate in the Study class during iteration.</span>

<span class="sd">        This method returns the next plate in the study, which can be either a `Plate` or a `QCPlate` instance.</span>
<span class="sd">        It is automatically called in each iteration of a loop. When all plates have been iterated over,</span>
<span class="sd">        it raises the StopIteration exception.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[Plate, QCPlate]: The next plate in the study, either a `Plate` or `QCPlate` instance.</span>

<span class="sd">        Raises:</span>
<span class="sd">            StopIteration: If all plates have been iterated over.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_count</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_plates</span><span class="p">:</span>
            <span class="n">plate_to_return</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plates</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_iter_count</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_iter_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">plate_to_return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the total number of plates in the Study.</span>

<span class="sd">        This method enables the use of the len() function on the Study instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The number of plates in the study.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plates</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an unambiguous string representation of the Study instance.</span>

<span class="sd">        This method is useful for debugging and logging purposes, as it represents the Study</span>
<span class="sd">        object in a clear and concise way.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: A string representation of the Study instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Study(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a readable string representation of the Study instance.</span>

<span class="sd">        This method provides a user-friendly string representation of the Study, which includes</span>
<span class="sd">        its name, the number of study specimens, and the total number of plates.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: A string describing the Study instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">study_specimens</span><span class="si">}</span><span class="s2"> on </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_plates</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Plate</span><span class="p">,</span> <span class="n">QCPlate</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve a specific plate from the study by its index.</span>

<span class="sd">        This method allows for direct access to a plate in the study using the indexing syntax.</span>

<span class="sd">        Args:</span>
<span class="sd">            index (int): The index of the plate to retrieve.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[Plate, QCPlate]: The plate at the specified index.</span>

<span class="sd">        Raises:</span>
<span class="sd">            IndexError: If the index is out of range of the plates list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plates</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">load_specimen_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sample_group_id_column</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads specimen records from a specified file into the study.</span>

<span class="sd">        This method reads specimen data from a file (Excel or CSV) and stores it in a DataFrame.</span>
<span class="sd">        It also identifies or sets the column used for grouping specimens.</span>

<span class="sd">        Args:</span>
<span class="sd">            records_file (str): The path to the file containing specimen records.</span>
<span class="sd">            sample_group_id_column (Optional[str]): The column name in the file that represents the group ID of samples. </span>
<span class="sd">                If None, the method attempts to find a suitable column automatically.</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileExistsError: If the specified records_file does not exist.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; study = Study(study_name=&quot;Oncology Study&quot;)</span>
<span class="sd">            &gt;&gt;&gt; study.load_specimen_records(&quot;specimens.xlsx&quot;, sample_group_id_column=&quot;PatientGroup&quot;)</span>
<span class="sd">            &gt;&gt;&gt; study.specimen_records_df.shape</span>
<span class="sd">            (200, 5)  # Example output, indicating 200 rows and 5 columns in the DataFrame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">records_file_path</span> <span class="o">=</span> <span class="n">records_file</span>
        <span class="n">records_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">records_file</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading records file: </span><span class="si">{</span><span class="n">records_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="n">records_path</span><span class="o">.</span><span class="n">suffix</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">records_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find file </span><span class="si">{</span><span class="n">records_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="n">records_file</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">extension</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.xlsx&quot;</span><span class="p">,</span> <span class="s2">&quot;.xls&quot;</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Importing Excel file.&quot;</span><span class="p">)</span>
            <span class="n">records</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">records_file</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">extension</span> <span class="o">==</span> <span class="s2">&quot;.csv&quot;</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Importing csv file.&quot;</span><span class="p">)</span>
            <span class="n">records</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">records_file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;File extension not recognized&quot;</span><span class="p">)</span>
            <span class="n">records</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">sample_group_id_column</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span> <span class="o">=</span> <span class="n">Study</span><span class="o">.</span><span class="n">_find_column_with_group_index</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span> <span class="o">=</span> <span class="n">sample_group_id_column</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">records</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> specimens in file&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Metadata in file:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">records</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sorting records in ascending order based on column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="n">records</span> <span class="o">=</span> <span class="n">records</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">specimen_records_df</span> <span class="o">=</span> <span class="n">records</span>

    <span class="k">def</span> <span class="nf">sort_records_within_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sortby_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sorts specimen records within each group based on a specified column.</span>

<span class="sd">        This method groups the specimen records by a predefined group index column and then sorts each group&#39;s records</span>
<span class="sd">        based on the specified &#39;sortby_column&#39;. The sorted groups are then concatenated back into the main DataFrame.</span>
<span class="sd">        This is useful for organizing records in a manner that respects the grouping while ordering the records within each group.</span>

<span class="sd">        Args:</span>
<span class="sd">            sortby_column (str): The column name in the specimen records DataFrame to sort by within each group.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If no group column is defined in the Study instance.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; study = Study(...)</span>
<span class="sd">            &gt;&gt;&gt; study.load_specimen_records(&quot;specimens.csv&quot;, sample_group_id_column=&quot;GroupID&quot;)</span>
<span class="sd">            &gt;&gt;&gt; study.sort_records_within_groups(&quot;Age&quot;)</span>
<span class="sd">            # This will sort the specimen records within each group based on the &quot;Age&quot; column.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sorting samples within </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="si">}</span><span class="s2"> by </span><span class="si">{</span><span class="n">sortby_column</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Step 1: Group the DataFrame by &#39;group_ID&#39;</span>
            <span class="n">grouped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specimen_records_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="p">)</span>

            <span class="c1"># Step 2: Sort each group by the &#39;sortby_column&#39; column</span>
            <span class="n">sorted_groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">sortby_column</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped</span><span class="p">]</span>

            <span class="c1"># Step 3: Concatenate the sorted groups back into a single DataFrame</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">specimen_records_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">sorted_groups</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No group column defined: self._column_with_group_index: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">position_sample_within_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sortby_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sample_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">position_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Repositions a specific sample within each group based on a specified value and index.</span>

<span class="sd">        This method allows altering the position of a sample within each group in the specimen records DataFrame.</span>
<span class="sd">        It locates a sample based on the &#39;sortby_column&#39; and &#39;sample_value&#39;, then repositions this sample within its group</span>
<span class="sd">        to the specified &#39;position_index&#39;. The method is useful for customizing the order of samples within groups</span>
<span class="sd">        based on specific criteria or requirements.</span>

<span class="sd">        Args:</span>
<span class="sd">            sortby_column (str): The column name in the specimen records DataFrame to identify the sample.</span>
<span class="sd">            sample_value (Any): The value in the &#39;sortby_column&#39; that identifies the sample to reposition.</span>
<span class="sd">            position_index (int): The new index within the group where the sample should be positioned.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If no group column is defined in the Study instance.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; study = Study(...)</span>
<span class="sd">            &gt;&gt;&gt; study.load_specimen_records(&quot;specimens.csv&quot;, sample_group_id_column=&quot;GroupID&quot;)</span>
<span class="sd">            &gt;&gt;&gt; study.position_sample_within_groups(&quot;PatientID&quot;, 12345, 2)</span>
<span class="sd">            # This will move the sample with PatientID 12345 to the index 2 position within its respective group.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Positioning sample within </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="si">}</span><span class="s2"> based on </span><span class="si">{</span><span class="n">sortby_column</span><span class="si">}</span><span class="s2"> value </span><span class="si">{</span><span class="n">sample_value</span><span class="si">}</span><span class="s2"> at index </span><span class="si">{</span><span class="n">position_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Step 1: Group the DataFrame by &#39;group_ID&#39;</span>
            <span class="n">grouped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specimen_records_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="p">)</span>

            <span class="c1"># Step 2: Modify each group</span>
            <span class="n">modified_groups</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped</span><span class="p">:</span>
                <span class="c1"># Find the row to reposition</span>
                <span class="n">sample_row</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">group</span><span class="p">[</span><span class="n">sortby_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample_value</span><span class="p">]</span>

                <span class="c1"># Remove this row from the group</span>
                <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">group</span><span class="p">[</span><span class="n">sortby_column</span><span class="p">]</span> <span class="o">!=</span> <span class="n">sample_value</span><span class="p">]</span>

                <span class="c1"># Split the group at the specified position index</span>
                <span class="n">first_part</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">position_index</span><span class="p">]</span>
                <span class="n">second_part</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">position_index</span><span class="p">:]</span>

                <span class="c1"># Concatenate first part, sample row, and second part</span>
                <span class="n">modified_group</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">first_part</span><span class="p">,</span> <span class="n">sample_row</span><span class="p">,</span> <span class="n">second_part</span><span class="p">])</span>

                <span class="n">modified_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modified_group</span><span class="p">)</span>

            <span class="c1"># Step 3: Concatenate the modified groups back into a single DataFrame</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">specimen_records_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">modified_groups</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No group column defined: self._column_with_group_index: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_specimens_to_plate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study_plate</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">specimen_samples_df</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds specimens from a DataFrame to a specified plate based on well metadata.</span>

<span class="sd">        This method iterates through each well of the given plate and, if the well&#39;s metadata indicates </span>
<span class="sd">        it should contain a specimen (as marked by &quot;sample_code&quot; == &quot;S&quot;), adds specimen data from the </span>
<span class="sd">        DataFrame to the well&#39;s metadata. The method stops adding specimens once all have been placed </span>
<span class="sd">        or the plate is filled.</span>

<span class="sd">        Args:</span>
<span class="sd">            study_plate (Plate): The plate object to which specimens will be added.</span>
<span class="sd">            specimen_samples_df (pd.DataFrame): DataFrame containing specimen data to be added to the plate.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - This is a private method intended for internal use within the class.</span>
<span class="sd">            - The method assumes that &#39;study_plate&#39; is an instance of &#39;Plate&#39; or a compatible type, and</span>
<span class="sd">            &#39;specimen_samples_df&#39; is a Pandas DataFrame with columns corresponding to metadata fields.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; study = Study(...)</span>
<span class="sd">            &gt;&gt;&gt; study_plate = Plate(...)  # Assume Plate is properly initialized</span>
<span class="sd">            &gt;&gt;&gt; specimens_df = pd.DataFrame(...)  # DataFrame with specimen data</span>
<span class="sd">            &gt;&gt;&gt; study._add_specimens_to_plate(study_plate, specimens_df)</span>
<span class="sd">            # Specimens from specimens_df are now added to the study_plate based on its well metadata</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">specimen_samples_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples to plate </span><span class="si">{</span><span class="n">study_plate</span><span class="o">.</span><span class="n">plate_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">specimen_samples_df</span><span class="o">.</span><span class="n">columns</span>

        <span class="c1"># keep track on how many wells we should use per batch</span>
        <span class="n">N_specimens_left</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">specimen_samples_df</span><span class="p">)</span>
        <span class="n">plate_specimen_count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">well</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">study_plate</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">well</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;sample_code&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;S&quot;</span><span class="p">:</span> 
                <span class="c1"># add metadata key (and values) for each column in dataframe</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
                    <span class="n">well</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">specimen_samples_df</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">plate_specimen_count</span><span class="p">]</span>

                <span class="n">plate_specimen_count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># add metadata key and nan value for each column in dataframe</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
                    <span class="n">well</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NaN&quot;</span>

            <span class="n">study_plate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">well</span>

            <span class="k">if</span> <span class="n">plate_specimen_count</span> <span class="o">&gt;=</span> <span class="n">N_specimens_left</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> -&gt; Done. Last specimen placed in </span><span class="si">{</span><span class="n">well</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">break</span>

        <span class="k">return</span> <span class="n">study_plate</span>

        <span class="c1"># --- END OF FOOR LOOP ---</span>

    <span class="k">def</span> <span class="nf">to_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the data from all plates in the study into a single Pandas DataFrame.</span>

<span class="sd">        This method iterates over each plate in the study and converts its data to a DataFrame. </span>
<span class="sd">        These DataFrames are then concatenated into a single DataFrame representing the entire study.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A DataFrame containing data from all plates in the study.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; study = Study(...)</span>
<span class="sd">            &gt;&gt;&gt; study_df = study.to_dataframe()</span>
<span class="sd">            &gt;&gt;&gt; study_df.head()</span>
<span class="sd">            # Displays the first few rows of the combined DataFrame for the study.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">plate</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plate</span><span class="o">.</span><span class="n">as_dataframe</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_layout_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata_keys</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span> 
                    <span class="n">file_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;csv&quot;</span><span class="p">,</span>
                    <span class="n">folder_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">plate_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;plate&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exports the layout of each plate in the study to files in the specified format.</span>

<span class="sd">        This method iterates over each plate in the study and exports its layout to a file. </span>
<span class="sd">        The files are saved in a specified format (CSV by default) and stored in a designated folder.</span>

<span class="sd">        Args:</span>
<span class="sd">            metadata_keys (list, optional): A list of metadata keys to include in the exported files.</span>
<span class="sd">            file_format (str, optional): The file format for the exported layouts (e.g., &#39;csv&#39;).</span>
<span class="sd">            folder_path (str, optional): The path to the folder where the layout files will be saved. </span>
<span class="sd">                If None, the current working directory is used.</span>
<span class="sd">            plate_name (str, optional): A base name for the layout files.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; study = Study(...)</span>
<span class="sd">            &gt;&gt;&gt; study.to_layout_lists(metadata_keys=[&quot;sample_type&quot;, &quot;concentration&quot;], </span>
<span class="sd">                                    file_format=&quot;csv&quot;, </span>
<span class="sd">                                    folder_path=&quot;/path/to/layouts&quot;, </span>
<span class="sd">                                    plate_name=&quot;experiment_plate&quot;)</span>
<span class="sd">            # This will save layout files for each plate in the &#39;/path/to/layouts&#39; directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">folder_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">folder_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">folder_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span>

        <span class="c1"># New folder path for &quot;layout_lists&quot;</span>
        <span class="n">new_folder_path</span> <span class="o">=</span> <span class="n">folder_path</span> <span class="o">/</span> <span class="s2">&quot;layout_lists&quot;</span>

        <span class="c1"># Create the &quot;layout_lists&quot; folder if it does not exist</span>
        <span class="n">new_folder_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">plate</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">plate_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">plate</span><span class="o">.</span><span class="n">plate_id</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="c1"># Update file path to include the new folder</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">new_folder_path</span> <span class="o">/</span> <span class="n">file_name</span>

            <span class="n">plate</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span>
                        <span class="n">file_format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                        <span class="n">metadata_keys</span><span class="o">=</span><span class="n">metadata_keys</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_layout_figures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">annotation_metadata_key</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                          <span class="n">color_metadata_key</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="n">file_format</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pdf&quot;</span><span class="p">,</span>
                        <span class="n">folder_path</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">plate_name</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Plate&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates and saves visual representations of each plate in the study as figures.</span>

<span class="sd">        This method iterates over each plate in the study, generating a figure based on specified metadata keys</span>
<span class="sd">        for annotation and coloring. The figures are saved in the specified file format in a designated folder.</span>

<span class="sd">        Args:</span>
<span class="sd">            annotation_metadata_key (str): The metadata key used for annotating elements in the figure.</span>
<span class="sd">            color_metadata_key (str): The metadata key used for coloring elements in the figure.</span>
<span class="sd">            file_format (str, optional): The format in which to save the figures (default is &#39;pdf&#39;).</span>
<span class="sd">            folder_path (Optional[str]): The path to the folder where the figures will be saved. </span>
<span class="sd">                If None, the current working directory is used.</span>
<span class="sd">            plate_name (str, optional): A base name for the figure files.</span>
<span class="sd">            **kwargs: Additional keyword arguments passed to the `as_figure` method of each plate.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; study = Study(...)</span>
<span class="sd">            &gt;&gt;&gt; study.to_layout_figures(annotation_metadata_key=&quot;sample_id&quot;,</span>
<span class="sd">                                    color_metadata_key=&quot;status&quot;,</span>
<span class="sd">                                    file_format=&quot;png&quot;,</span>
<span class="sd">                                    folder_path=&quot;/path/to/figures&quot;,</span>
<span class="sd">                                    plate_name=&quot;study_plate&quot;)</span>
<span class="sd">            # This will create and save figures for each plate in the &#39;/path/to/figures&#39; directory,</span>
<span class="sd">            # with annotations and colorings based on &#39;sample_id&#39; and &#39;status&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">folder_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">folder_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">folder_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span>

        <span class="c1"># New folder path for &quot;layout_lists&quot;</span>
        <span class="n">new_folder_path</span> <span class="o">=</span> <span class="n">folder_path</span> <span class="o">/</span> <span class="s2">&quot;layout_figures&quot;</span>

        <span class="c1"># Create the &quot;layout_lists&quot; folder if it does not exist</span>
        <span class="n">new_folder_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">plate</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">plate_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">plate</span><span class="o">.</span><span class="n">plate_id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">annotation_metadata_key</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">color_metadata_key</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">file_format</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">new_folder_path</span> <span class="o">/</span> <span class="n">file_name</span>

            <span class="c1"># Define title        </span>
            <span class="n">title_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: Plate </span><span class="si">{</span><span class="n">plate</span><span class="o">.</span><span class="n">plate_id</span><span class="si">}</span><span class="s2">, showing </span><span class="si">{</span><span class="n">annotation_metadata_key</span><span class="si">}</span><span class="s2"> colored by </span><span class="si">{</span><span class="n">color_metadata_key</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plate</span><span class="o">.</span><span class="n">as_figure</span><span class="p">(</span><span class="n">annotation_metadata_key</span><span class="p">,</span> <span class="n">color_metadata_key</span><span class="p">,</span> <span class="n">title_str</span><span class="o">=</span><span class="n">title_str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving plate figure to </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">distribute_samples_to_plates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plate_layout</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Plate</span><span class="p">,</span> <span class="n">QCPlate</span><span class="p">],</span> <span class="n">allow_group_split</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">N_samples_desired_plate</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Distributes specimens across multiple plates based on a specified layout, with an option to keep group integrity.</span>

<span class="sd">        This method iterates through the study&#39;s specimen records and distributes them across multiple plates </span>
<span class="sd">        according to the provided plate layout. It supports options to either keep specimen groups together or </span>
<span class="sd">        allow splitting them across different plates. The method can also handle a specified number of samples </span>
<span class="sd">        per plate if desired.</span>

<span class="sd">        Args:</span>
<span class="sd">            plate_layout (Union[Plate, QCPlate]): The layout template for the plates. This can be an instance of </span>
<span class="sd">                &#39;Plate&#39; or &#39;QCPlate&#39;.</span>
<span class="sd">            allow_group_split (bool, optional): If False (default), keeps specimens within the same group on the </span>
<span class="sd">                same plate. If True, allows splitting groups across plates.</span>
<span class="sd">            N_samples_desired_plate (Optional[int], optional): The desired number of samples per plate. If not </span>
<span class="sd">                specified, fills each plate to its capacity.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the group column is not defined in the specimen records.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; study = Study(...)</span>
<span class="sd">            &gt;&gt;&gt; study.load_specimen_records(&quot;specimens.csv&quot;, sample_group_id_column=&quot;GroupID&quot;)</span>
<span class="sd">            &gt;&gt;&gt; plate_layout = Plate(...)  # Assume Plate is properly initialized</span>
<span class="sd">            &gt;&gt;&gt; study.distribute_samples_to_plates(plate_layout, allow_group_split=False)</span>
<span class="sd">            # This will distribute the specimens across plates, keeping groups together.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">plate_number</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">plates</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Copy the specimen data to work on</span>
        <span class="n">remaining_specimens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specimen_records_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">N_specimens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specimen_records_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">N_samples_desired_plate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">N_samples_desired_plate</span> <span class="o">=</span> <span class="n">plate_layout</span><span class="o">.</span><span class="n">capacity</span>

        <span class="c1"># N_QCsample_in_plate = plate_layout.get_metadata_as_numpy_array(&quot;QC&quot;).sum()</span>
        <span class="c1"># N_plates_estimate = N_specimens / (plate_layout._specimen_capacity)</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="n">remaining_specimens</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">current_plate</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">plate_layout</span><span class="p">)</span>
            <span class="n">current_plate</span><span class="o">.</span><span class="n">plate_id</span> <span class="o">=</span> <span class="n">plate_number</span>

            <span class="c1"># Select specimens for the current plate</span>
            <span class="n">N_remaining</span> <span class="o">=</span> <span class="n">remaining_specimens</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># if the remaining samples can fit on a whole place we put them there,</span>
            <span class="c1"># otherwise we place the desired number of samples on the plate.</span>
            <span class="c1"># if not we </span>
            <span class="k">if</span> <span class="n">N_remaining</span> <span class="o">&lt;</span> <span class="n">current_plate</span><span class="o">.</span><span class="n">capacity</span><span class="p">:</span>
                <span class="n">selected_specimens</span> <span class="o">=</span> <span class="n">remaining_specimens</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">current_plate</span><span class="o">.</span><span class="n">capacity</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">selected_specimens</span> <span class="o">=</span> <span class="n">remaining_specimens</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">N_samples_desired_plate</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_group_split</span><span class="p">:</span>
                <span class="c1"># Extract unique group IDs from the selected specimens. This step identifies the distinct groups</span>
                <span class="c1"># that are represented within the specimens currently being considered for this plate.</span>
                <span class="n">group_ids</span> <span class="o">=</span> <span class="n">selected_specimens</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

                <span class="c1"># Find all specimens in the remaining pool that belong to the same groups as the selected specimens.</span>
                <span class="n">specimens_in_groups</span> <span class="o">=</span> <span class="n">remaining_specimens</span><span class="p">[</span><span class="n">remaining_specimens</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)]</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">specimens_in_groups</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_specimens</span><span class="p">):</span>
                    <span class="c1"># If there are more specimens in the remaining pool belonging to the same groups,</span>
                    <span class="c1"># it indicates that the last group in &#39;selected_specimens&#39; is split between this plate and the remaining pool.</span>
                    <span class="c1"># To avoid splitting the group, we modify &#39;selected_specimens&#39; to exclude this last group.</span>

                    <span class="c1"># Determine the groups to keep on the current plate. This is done by excluding the last group ID</span>
                    <span class="c1"># from the list of unique group IDs in the selected specimens. This way, we ensure that an entire group </span>
                    <span class="c1"># is not split across plates.</span>
                    <span class="n">groups_to_keep</span> <span class="o">=</span> <span class="n">group_ids</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                    <span class="c1"># Update &#39;selected_specimens&#39; to only include specimens from the groups that are not split.</span>
                    <span class="n">selected_specimens</span> <span class="o">=</span> <span class="n">selected_specimens</span><span class="p">[</span><span class="n">selected_specimens</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">groups_to_keep</span><span class="p">)]</span>

            <span class="c1"># Remove selected specimens from the pool</span>
            <span class="n">remaining_specimens</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">selected_specimens</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">selected_specimens</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">remaining_specimens</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Add specimens to the current plate</span>
            <span class="n">current_plate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_specimens_to_plate</span><span class="p">(</span><span class="n">current_plate</span><span class="p">,</span> <span class="n">selected_specimens</span><span class="p">)</span>
            <span class="n">plates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_plate</span><span class="p">)</span>

            <span class="n">plate_number</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plates</span> <span class="o">=</span> <span class="n">plates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_plates</span> <span class="o">=</span> <span class="n">plate_number</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distributed samples across </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_plates</span><span class="si">}</span><span class="s2"> plates.&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_find_column_with_group_index</span><span class="p">(</span><span class="n">specimen_records_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Identifies the column in a DataFrame that likely represents group indices based on integer pairs.</span>

<span class="sd">        This static method analyzes a provided DataFrame to determine which column could represent group indices.</span>
<span class="sd">        It looks for columns with integer values where pairs of consecutive numbers are common, indicating a</span>
<span class="sd">        potential grouping pattern. The method is specifically designed to identify groups based on pair numbers.</span>

<span class="sd">        Args:</span>
<span class="sd">            specimen_records_df (pd.DataFrame): The DataFrame containing specimen records.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The name of the column that likely represents group indices. Returns an empty string if no suitable</span>
<span class="sd">                column is found.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; specimen_records_df = pd.DataFrame({&#39;GroupID&#39;: [1, 1, 2, 2, 3, 3], &#39;Data&#39;: [100, 101, 102, 103, 104, 105]})</span>
<span class="sd">            &gt;&gt;&gt; Study._find_column_with_group_index(specimen_records_df)</span>
<span class="sd">            &#39;GroupID&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">int_cols</span> <span class="o">=</span> <span class="n">specimen_records_df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Looking for group index of study pairs in the following table columns:&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">int_cols</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="si">{</span><span class="n">col_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># sort in ascending order</span>
            <span class="n">int_col</span> <span class="o">=</span> <span class="n">int_cols</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
            <span class="c1"># compute difference: n_1 - n_2, n_2 - n_3, ...</span>
            <span class="n">int_diffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">int_col</span><span class="p">)</span>
            <span class="c1"># count instances were numbers were the same, i.e. diff == 0</span>
            <span class="n">n_zeros</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span> <span class="n">int_diffs</span><span class="p">)))</span>
            <span class="c1"># we assume column contains pairs if #pairs == #samples / 2</span>
            <span class="n">column_have_pairs</span> <span class="o">=</span> <span class="n">n_zeros</span> <span class="o">==</span> <span class="p">(</span><span class="n">int_col</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">column_have_pairs</span><span class="p">:</span><span class="c1"># we found a column so let&#39;s assume it is the correct one</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found group index in column </span><span class="si">{</span><span class="n">col_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">col_name</span>

        <span class="k">return</span> <span class="s2">&quot;&quot;</span> 

    <span class="k">def</span> <span class="nf">randomize_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">case_control</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">reproducible</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Randomizes the order of specimen records in the study, optionally maintaining group integrity.</span>

<span class="sd">        This method either randomizes the entire order of specimens or maintains the order within groups,</span>
<span class="sd">        depending on the &#39;case_control&#39; flag. It also allows for reproducible randomization using a fixed seed.</span>

<span class="sd">        Args:</span>
<span class="sd">            case_control (Optional[bool]): If True, maintains group order (samples within a group are not shuffled).</span>
<span class="sd">                If False, shuffles all samples regardless of group. If None, the behavior is determined based on </span>
<span class="sd">                the presence of a group index column.</span>
<span class="sd">            reproducible (bool): If True, uses a fixed seed for randomization to ensure reproducibility.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; study = Study(study_name=&quot;Diabetes Study&quot;)</span>
<span class="sd">            &gt;&gt;&gt; study.load_specimen_records(&quot;patients.csv&quot;, sample_group_id_column=&quot;GroupID&quot;)</span>
<span class="sd">            &gt;&gt;&gt; study.randomize_order(case_control=True)</span>
<span class="sd">            &gt;&gt;&gt; study.specimen_records_df.head(3)  # Example output showing randomized order within groups.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specimen_records_df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;There are no study records loaded. Use &#39;load_specimen_records&#39; method to import study records.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">case_control</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="p">:</span>
                <span class="n">case_control</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">case_control</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">specimen_records_df_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specimen_records_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">case_control</span><span class="p">:</span>
            <span class="n">column_with_group_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Randomly permuting group order (samples within group unchanged) using variable &#39;</span><span class="si">{</span><span class="n">column_with_group_index</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Creating multiindex dataframe&quot;</span><span class="p">)</span>
            <span class="n">specimen_records_df_copy</span> <span class="o">=</span> <span class="n">specimen_records_df_copy</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">column_with_group_index</span><span class="p">,</span> <span class="n">specimen_records_df_copy</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
            <span class="n">drop</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Randomly permuting sample order.&quot;</span><span class="p">)</span>
            <span class="n">specimen_records_df_copy</span> <span class="o">=</span> <span class="n">specimen_records_df_copy</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">specimen_records_df_copy</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">specimen_records_df_copy</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
            <span class="n">column_with_group_index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span>


        <span class="n">group_IDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">specimen_records_df_copy</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

        <span class="c1"># Permute order in table</span>
        <span class="k">if</span> <span class="n">reproducible</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using a fixed seed to random number generator for reproducibility; </span><span class="se">\</span>
<span class="s2">                running this method will always give the same result.&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using class-determined seed </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_seed</span><span class="si">}</span><span class="s2"> for random number generator&quot;</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_seed</span><span class="p">)</span>

        <span class="n">permutation_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">group_IDs</span><span class="p">)</span>

        <span class="n">prev_index_str</span> <span class="o">=</span> <span class="s2">&quot;index_before_permutation&quot;</span>

        <span class="c1"># if multiple randomization rounds, remove old column = prev_index_str </span>
        <span class="k">if</span> <span class="n">prev_index_str</span> <span class="ow">in</span> <span class="n">specimen_records_df_copy</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">specimen_records_df_copy</span> <span class="o">=</span> <span class="n">specimen_records_df_copy</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">prev_index_str</span><span class="p">)</span>

        <span class="n">specimen_records_df_copy</span> <span class="o">=</span> <span class="n">specimen_records_df_copy</span> \
                                    <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">permutation_order</span><span class="p">]</span>\
                                    <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">column_with_group_index</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="n">drop</span><span class="p">)</span>\
                                    <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">specimen_records_df_copy</span> <span class="o">=</span> <span class="n">specimen_records_df_copy</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;index_before_permutation&quot;</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_N_permutations</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specimen_records_df</span> <span class="o">=</span> <span class="n">specimen_records_df_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="src.study.Study.__getitem__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__getitem__</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Retrieve a specific plate from the study by its index.</p>
<p>This method allows for direct access to a plate in the study using the indexing syntax.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>index</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The index of the plate to retrieve.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="src.plateplanner.plate.Plate">Plate</span>, <span title="src.plateplanner.plate.QCPlate">QCPlate</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Union[Plate, QCPlate]: The plate at the specified index.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>IndexError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If the index is out of range of the plates list.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/study.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Plate</span><span class="p">,</span> <span class="n">QCPlate</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve a specific plate from the study by its index.</span>

<span class="sd">    This method allows for direct access to a plate in the study using the indexing syntax.</span>

<span class="sd">    Args:</span>
<span class="sd">        index (int): The index of the plate to retrieve.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[Plate, QCPlate]: The plate at the specified index.</span>

<span class="sd">    Raises:</span>
<span class="sd">        IndexError: If the index is out of range of the plates list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plates</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.study.Study.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">study_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initializes a new instance of the Study class.</p>
<p>This constructor sets up a study with a specified name. If no name is provided, a default name 
is generated using the current date.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>study_name</code></td>
          <td>
                <code>Optional[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name for the study. If None, a default name in the format 
"Study_YYYY-MM-DD" is assigned, where YYYY-MM-DD represents the current date.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">study1</span> <span class="o">=</span> <span class="n">Study</span><span class="p">(</span><span class="n">study_name</span><span class="o">=</span><span class="s2">&quot;Alzheimer&#39;s Research&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">study1</span><span class="o">.</span><span class="n">name</span>
<span class="go">&quot;Alzheimer&#39;s Research&quot;</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">study2</span> <span class="o">=</span> <span class="n">Study</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">study2</span><span class="o">.</span><span class="n">name</span>
<span class="go">&quot;Study_2024-01-21&quot;  # Example output; actual output will vary based on the current date.</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>src/study.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initializes a new instance of the Study class.</span>

<span class="sd">    This constructor sets up a study with a specified name. If no name is provided, a default name </span>
<span class="sd">    is generated using the current date.</span>

<span class="sd">    Args:</span>
<span class="sd">        study_name (Optional[str]): The name for the study. If None, a default name in the format </span>
<span class="sd">            &quot;Study_YYYY-MM-DD&quot; is assigned, where YYYY-MM-DD represents the current date.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; study1 = Study(study_name=&quot;Alzheimer&#39;s Research&quot;)</span>
<span class="sd">        &gt;&gt;&gt; study1.name</span>
<span class="sd">        &quot;Alzheimer&#39;s Research&quot;</span>

<span class="sd">        &gt;&gt;&gt; study2 = Study()</span>
<span class="sd">        &gt;&gt;&gt; study2.name</span>
<span class="sd">        &quot;Study_2024-01-21&quot;  # Example output; actual output will vary based on the current date.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">study_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">study_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Study_</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">study_name</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.study.Study.__iter__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__iter__</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize the iterator for the Study class.</p>
<p>This method sets up the class to iterate over its plates, resetting the internal counter 
to zero. It allows the Study instance to be used in a loop (e.g., a for loop), 
facilitating iteration over its plates.</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="src.plateplanner.plate.Plate">Plate</span>, <span title="src.plateplanner.plate.QCPlate">QCPlate</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Iterator[Union[Plate, QCPlate]]: An iterator that yields either <code>Plate</code> or <code>QCPlate</code> </p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="src.plateplanner.plate.Plate">Plate</span>, <span title="src.plateplanner.plate.QCPlate">QCPlate</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>instances, allowing the Study instance to be used in a loop.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/study.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Plate</span><span class="p">,</span> <span class="n">QCPlate</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the iterator for the Study class.</span>

<span class="sd">    This method sets up the class to iterate over its plates, resetting the internal counter </span>
<span class="sd">    to zero. It allows the Study instance to be used in a loop (e.g., a for loop), </span>
<span class="sd">    facilitating iteration over its plates.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Iterator[Union[Plate, QCPlate]]: An iterator that yields either `Plate` or `QCPlate` </span>
<span class="sd">        instances, allowing the Study instance to be used in a loop.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_iter_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.study.Study.__len__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__len__</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return the total number of plates in the Study.</p>
<p>This method enables the use of the len() function on the Study instance.</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>int</code></td>          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The number of plates in the study.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/study.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the total number of plates in the Study.</span>

<span class="sd">    This method enables the use of the len() function on the Study instance.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: The number of plates in the study.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plates</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.study.Study.__next__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__next__</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Proceed to the next plate in the Study class during iteration.</p>
<p>This method returns the next plate in the study, which can be either a <code>Plate</code> or a <code>QCPlate</code> instance.
It is automatically called in each iteration of a loop. When all plates have been iterated over,
it raises the StopIteration exception.</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="src.plateplanner.plate.Plate">Plate</span>, <span title="src.plateplanner.plate.QCPlate">QCPlate</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Union[Plate, QCPlate]: The next plate in the study, either a <code>Plate</code> or <code>QCPlate</code> instance.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>StopIteration</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If all plates have been iterated over.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/study.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Plate</span><span class="p">,</span> <span class="n">QCPlate</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Proceed to the next plate in the Study class during iteration.</span>

<span class="sd">    This method returns the next plate in the study, which can be either a `Plate` or a `QCPlate` instance.</span>
<span class="sd">    It is automatically called in each iteration of a loop. When all plates have been iterated over,</span>
<span class="sd">    it raises the StopIteration exception.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[Plate, QCPlate]: The next plate in the study, either a `Plate` or `QCPlate` instance.</span>

<span class="sd">    Raises:</span>
<span class="sd">        StopIteration: If all plates have been iterated over.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_count</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_plates</span><span class="p">:</span>
        <span class="n">plate_to_return</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plates</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_iter_count</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iter_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">plate_to_return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">StopIteration</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.study.Study.__repr__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__repr__</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return an unambiguous string representation of the Study instance.</p>
<p>This method is useful for debugging and logging purposes, as it represents the Study
object in a clear and concise way.</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A string representation of the Study instance.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/study.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return an unambiguous string representation of the Study instance.</span>

<span class="sd">    This method is useful for debugging and logging purposes, as it represents the Study</span>
<span class="sd">    object in a clear and concise way.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A string representation of the Study instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Study(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.study.Study.__str__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__str__</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return a readable string representation of the Study instance.</p>
<p>This method provides a user-friendly string representation of the Study, which includes
its name, the number of study specimens, and the total number of plates.</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A string describing the Study instance.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/study.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a readable string representation of the Study instance.</span>

<span class="sd">    This method provides a user-friendly string representation of the Study, which includes</span>
<span class="sd">    its name, the number of study specimens, and the total number of plates.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A string describing the Study instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">study_specimens</span><span class="si">}</span><span class="s2"> on </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_plates</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.study.Study.distribute_samples_to_plates" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">distribute_samples_to_plates</span><span class="p">(</span><span class="n">plate_layout</span><span class="p">,</span> <span class="n">allow_group_split</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">N_samples_desired_plate</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Distributes specimens across multiple plates based on a specified layout, with an option to keep group integrity.</p>
<p>This method iterates through the study's specimen records and distributes them across multiple plates 
according to the provided plate layout. It supports options to either keep specimen groups together or 
allow splitting them across different plates. The method can also handle a specified number of samples 
per plate if desired.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>plate_layout</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="src.plateplanner.plate.Plate">Plate</span>, <span title="src.plateplanner.plate.QCPlate">QCPlate</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The layout template for the plates. This can be an instance of 
'Plate' or 'QCPlate'.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>allow_group_split</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If False (default), keeps specimens within the same group on the 
same plate. If True, allows splitting groups across plates.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>N_samples_desired_plate</code></td>
          <td>
                <code>Optional[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The desired number of samples per plate. If not 
specified, fills each plate to its capacity.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If the group column is not defined in the specimen records.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">study</span> <span class="o">=</span> <span class="n">Study</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">study</span><span class="o">.</span><span class="n">load_specimen_records</span><span class="p">(</span><span class="s2">&quot;specimens.csv&quot;</span><span class="p">,</span> <span class="n">sample_group_id_column</span><span class="o">=</span><span class="s2">&quot;GroupID&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plate_layout</span> <span class="o">=</span> <span class="n">Plate</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>  <span class="c1"># Assume Plate is properly initialized</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">study</span><span class="o">.</span><span class="n">distribute_samples_to_plates</span><span class="p">(</span><span class="n">plate_layout</span><span class="p">,</span> <span class="n">allow_group_split</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="go"># This will distribute the specimens across plates, keeping groups together.</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>src/study.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">distribute_samples_to_plates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plate_layout</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Plate</span><span class="p">,</span> <span class="n">QCPlate</span><span class="p">],</span> <span class="n">allow_group_split</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">N_samples_desired_plate</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Distributes specimens across multiple plates based on a specified layout, with an option to keep group integrity.</span>

<span class="sd">    This method iterates through the study&#39;s specimen records and distributes them across multiple plates </span>
<span class="sd">    according to the provided plate layout. It supports options to either keep specimen groups together or </span>
<span class="sd">    allow splitting them across different plates. The method can also handle a specified number of samples </span>
<span class="sd">    per plate if desired.</span>

<span class="sd">    Args:</span>
<span class="sd">        plate_layout (Union[Plate, QCPlate]): The layout template for the plates. This can be an instance of </span>
<span class="sd">            &#39;Plate&#39; or &#39;QCPlate&#39;.</span>
<span class="sd">        allow_group_split (bool, optional): If False (default), keeps specimens within the same group on the </span>
<span class="sd">            same plate. If True, allows splitting groups across plates.</span>
<span class="sd">        N_samples_desired_plate (Optional[int], optional): The desired number of samples per plate. If not </span>
<span class="sd">            specified, fills each plate to its capacity.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the group column is not defined in the specimen records.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; study = Study(...)</span>
<span class="sd">        &gt;&gt;&gt; study.load_specimen_records(&quot;specimens.csv&quot;, sample_group_id_column=&quot;GroupID&quot;)</span>
<span class="sd">        &gt;&gt;&gt; plate_layout = Plate(...)  # Assume Plate is properly initialized</span>
<span class="sd">        &gt;&gt;&gt; study.distribute_samples_to_plates(plate_layout, allow_group_split=False)</span>
<span class="sd">        # This will distribute the specimens across plates, keeping groups together.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">plate_number</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">plates</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Copy the specimen data to work on</span>
    <span class="n">remaining_specimens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specimen_records_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">N_specimens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specimen_records_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">N_samples_desired_plate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">N_samples_desired_plate</span> <span class="o">=</span> <span class="n">plate_layout</span><span class="o">.</span><span class="n">capacity</span>

    <span class="c1"># N_QCsample_in_plate = plate_layout.get_metadata_as_numpy_array(&quot;QC&quot;).sum()</span>
    <span class="c1"># N_plates_estimate = N_specimens / (plate_layout._specimen_capacity)</span>

    <span class="k">while</span> <span class="ow">not</span> <span class="n">remaining_specimens</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">current_plate</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">plate_layout</span><span class="p">)</span>
        <span class="n">current_plate</span><span class="o">.</span><span class="n">plate_id</span> <span class="o">=</span> <span class="n">plate_number</span>

        <span class="c1"># Select specimens for the current plate</span>
        <span class="n">N_remaining</span> <span class="o">=</span> <span class="n">remaining_specimens</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># if the remaining samples can fit on a whole place we put them there,</span>
        <span class="c1"># otherwise we place the desired number of samples on the plate.</span>
        <span class="c1"># if not we </span>
        <span class="k">if</span> <span class="n">N_remaining</span> <span class="o">&lt;</span> <span class="n">current_plate</span><span class="o">.</span><span class="n">capacity</span><span class="p">:</span>
            <span class="n">selected_specimens</span> <span class="o">=</span> <span class="n">remaining_specimens</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">current_plate</span><span class="o">.</span><span class="n">capacity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">selected_specimens</span> <span class="o">=</span> <span class="n">remaining_specimens</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">N_samples_desired_plate</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_group_split</span><span class="p">:</span>
            <span class="c1"># Extract unique group IDs from the selected specimens. This step identifies the distinct groups</span>
            <span class="c1"># that are represented within the specimens currently being considered for this plate.</span>
            <span class="n">group_ids</span> <span class="o">=</span> <span class="n">selected_specimens</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

            <span class="c1"># Find all specimens in the remaining pool that belong to the same groups as the selected specimens.</span>
            <span class="n">specimens_in_groups</span> <span class="o">=</span> <span class="n">remaining_specimens</span><span class="p">[</span><span class="n">remaining_specimens</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">specimens_in_groups</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_specimens</span><span class="p">):</span>
                <span class="c1"># If there are more specimens in the remaining pool belonging to the same groups,</span>
                <span class="c1"># it indicates that the last group in &#39;selected_specimens&#39; is split between this plate and the remaining pool.</span>
                <span class="c1"># To avoid splitting the group, we modify &#39;selected_specimens&#39; to exclude this last group.</span>

                <span class="c1"># Determine the groups to keep on the current plate. This is done by excluding the last group ID</span>
                <span class="c1"># from the list of unique group IDs in the selected specimens. This way, we ensure that an entire group </span>
                <span class="c1"># is not split across plates.</span>
                <span class="n">groups_to_keep</span> <span class="o">=</span> <span class="n">group_ids</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="c1"># Update &#39;selected_specimens&#39; to only include specimens from the groups that are not split.</span>
                <span class="n">selected_specimens</span> <span class="o">=</span> <span class="n">selected_specimens</span><span class="p">[</span><span class="n">selected_specimens</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">groups_to_keep</span><span class="p">)]</span>

        <span class="c1"># Remove selected specimens from the pool</span>
        <span class="n">remaining_specimens</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">selected_specimens</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">selected_specimens</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">remaining_specimens</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Add specimens to the current plate</span>
        <span class="n">current_plate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_specimens_to_plate</span><span class="p">(</span><span class="n">current_plate</span><span class="p">,</span> <span class="n">selected_specimens</span><span class="p">)</span>
        <span class="n">plates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_plate</span><span class="p">)</span>

        <span class="n">plate_number</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">plates</span> <span class="o">=</span> <span class="n">plates</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_plates</span> <span class="o">=</span> <span class="n">plate_number</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distributed samples across </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_plates</span><span class="si">}</span><span class="s2"> plates.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.study.Study.load_specimen_records" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">load_specimen_records</span><span class="p">(</span><span class="n">records_file</span><span class="p">,</span> <span class="n">sample_group_id_column</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Loads specimen records from a specified file into the study.</p>
<p>This method reads specimen data from a file (Excel or CSV) and stores it in a DataFrame.
It also identifies or sets the column used for grouping specimens.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>records_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path to the file containing specimen records.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>sample_group_id_column</code></td>
          <td>
                <code>Optional[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The column name in the file that represents the group ID of samples. 
If None, the method attempts to find a suitable column automatically.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>FileExistsError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If the specified records_file does not exist.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">study</span> <span class="o">=</span> <span class="n">Study</span><span class="p">(</span><span class="n">study_name</span><span class="o">=</span><span class="s2">&quot;Oncology Study&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">study</span><span class="o">.</span><span class="n">load_specimen_records</span><span class="p">(</span><span class="s2">&quot;specimens.xlsx&quot;</span><span class="p">,</span> <span class="n">sample_group_id_column</span><span class="o">=</span><span class="s2">&quot;PatientGroup&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">study</span><span class="o">.</span><span class="n">specimen_records_df</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(200, 5)  # Example output, indicating 200 rows and 5 columns in the DataFrame.</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>src/study.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_specimen_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sample_group_id_column</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads specimen records from a specified file into the study.</span>

<span class="sd">    This method reads specimen data from a file (Excel or CSV) and stores it in a DataFrame.</span>
<span class="sd">    It also identifies or sets the column used for grouping specimens.</span>

<span class="sd">    Args:</span>
<span class="sd">        records_file (str): The path to the file containing specimen records.</span>
<span class="sd">        sample_group_id_column (Optional[str]): The column name in the file that represents the group ID of samples. </span>
<span class="sd">            If None, the method attempts to find a suitable column automatically.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileExistsError: If the specified records_file does not exist.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; study = Study(study_name=&quot;Oncology Study&quot;)</span>
<span class="sd">        &gt;&gt;&gt; study.load_specimen_records(&quot;specimens.xlsx&quot;, sample_group_id_column=&quot;PatientGroup&quot;)</span>
<span class="sd">        &gt;&gt;&gt; study.specimen_records_df.shape</span>
<span class="sd">        (200, 5)  # Example output, indicating 200 rows and 5 columns in the DataFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">records_file_path</span> <span class="o">=</span> <span class="n">records_file</span>
    <span class="n">records_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">records_file</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading records file: </span><span class="si">{</span><span class="n">records_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">extension</span> <span class="o">=</span> <span class="n">records_path</span><span class="o">.</span><span class="n">suffix</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">records_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find file </span><span class="si">{</span><span class="n">records_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="n">records_file</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">extension</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.xlsx&quot;</span><span class="p">,</span> <span class="s2">&quot;.xls&quot;</span><span class="p">]:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Importing Excel file.&quot;</span><span class="p">)</span>
        <span class="n">records</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">records_file</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">extension</span> <span class="o">==</span> <span class="s2">&quot;.csv&quot;</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Importing csv file.&quot;</span><span class="p">)</span>
        <span class="n">records</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">records_file</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;File extension not recognized&quot;</span><span class="p">)</span>
        <span class="n">records</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">sample_group_id_column</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span> <span class="o">=</span> <span class="n">Study</span><span class="o">.</span><span class="n">_find_column_with_group_index</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span> <span class="o">=</span> <span class="n">sample_group_id_column</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">records</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> specimens in file&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Metadata in file:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">records</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sorting records in ascending order based on column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="n">records</span> <span class="o">=</span> <span class="n">records</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="p">])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">specimen_records_df</span> <span class="o">=</span> <span class="n">records</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.study.Study.position_sample_within_groups" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">position_sample_within_groups</span><span class="p">(</span><span class="n">sortby_column</span><span class="p">,</span> <span class="n">sample_value</span><span class="p">,</span> <span class="n">position_index</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Repositions a specific sample within each group based on a specified value and index.</p>
<p>This method allows altering the position of a sample within each group in the specimen records DataFrame.
It locates a sample based on the 'sortby_column' and 'sample_value', then repositions this sample within its group
to the specified 'position_index'. The method is useful for customizing the order of samples within groups
based on specific criteria or requirements.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>sortby_column</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The column name in the specimen records DataFrame to identify the sample.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>sample_value</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The value in the 'sortby_column' that identifies the sample to reposition.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>position_index</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The new index within the group where the sample should be positioned.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If no group column is defined in the Study instance.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">study</span> <span class="o">=</span> <span class="n">Study</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">study</span><span class="o">.</span><span class="n">load_specimen_records</span><span class="p">(</span><span class="s2">&quot;specimens.csv&quot;</span><span class="p">,</span> <span class="n">sample_group_id_column</span><span class="o">=</span><span class="s2">&quot;GroupID&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">study</span><span class="o">.</span><span class="n">position_sample_within_groups</span><span class="p">(</span><span class="s2">&quot;PatientID&quot;</span><span class="p">,</span> <span class="mi">12345</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="go"># This will move the sample with PatientID 12345 to the index 2 position within its respective group.</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>src/study.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">position_sample_within_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sortby_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sample_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">position_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Repositions a specific sample within each group based on a specified value and index.</span>

<span class="sd">    This method allows altering the position of a sample within each group in the specimen records DataFrame.</span>
<span class="sd">    It locates a sample based on the &#39;sortby_column&#39; and &#39;sample_value&#39;, then repositions this sample within its group</span>
<span class="sd">    to the specified &#39;position_index&#39;. The method is useful for customizing the order of samples within groups</span>
<span class="sd">    based on specific criteria or requirements.</span>

<span class="sd">    Args:</span>
<span class="sd">        sortby_column (str): The column name in the specimen records DataFrame to identify the sample.</span>
<span class="sd">        sample_value (Any): The value in the &#39;sortby_column&#39; that identifies the sample to reposition.</span>
<span class="sd">        position_index (int): The new index within the group where the sample should be positioned.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If no group column is defined in the Study instance.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; study = Study(...)</span>
<span class="sd">        &gt;&gt;&gt; study.load_specimen_records(&quot;specimens.csv&quot;, sample_group_id_column=&quot;GroupID&quot;)</span>
<span class="sd">        &gt;&gt;&gt; study.position_sample_within_groups(&quot;PatientID&quot;, 12345, 2)</span>
<span class="sd">        # This will move the sample with PatientID 12345 to the index 2 position within its respective group.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Positioning sample within </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="si">}</span><span class="s2"> based on </span><span class="si">{</span><span class="n">sortby_column</span><span class="si">}</span><span class="s2"> value </span><span class="si">{</span><span class="n">sample_value</span><span class="si">}</span><span class="s2"> at index </span><span class="si">{</span><span class="n">position_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Step 1: Group the DataFrame by &#39;group_ID&#39;</span>
        <span class="n">grouped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specimen_records_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="p">)</span>

        <span class="c1"># Step 2: Modify each group</span>
        <span class="n">modified_groups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped</span><span class="p">:</span>
            <span class="c1"># Find the row to reposition</span>
            <span class="n">sample_row</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">group</span><span class="p">[</span><span class="n">sortby_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample_value</span><span class="p">]</span>

            <span class="c1"># Remove this row from the group</span>
            <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">group</span><span class="p">[</span><span class="n">sortby_column</span><span class="p">]</span> <span class="o">!=</span> <span class="n">sample_value</span><span class="p">]</span>

            <span class="c1"># Split the group at the specified position index</span>
            <span class="n">first_part</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">position_index</span><span class="p">]</span>
            <span class="n">second_part</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">position_index</span><span class="p">:]</span>

            <span class="c1"># Concatenate first part, sample row, and second part</span>
            <span class="n">modified_group</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">first_part</span><span class="p">,</span> <span class="n">sample_row</span><span class="p">,</span> <span class="n">second_part</span><span class="p">])</span>

            <span class="n">modified_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modified_group</span><span class="p">)</span>

        <span class="c1"># Step 3: Concatenate the modified groups back into a single DataFrame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specimen_records_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">modified_groups</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No group column defined: self._column_with_group_index: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.study.Study.randomize_order" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">randomize_order</span><span class="p">(</span><span class="n">case_control</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reproducible</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Randomizes the order of specimen records in the study, optionally maintaining group integrity.</p>
<p>This method either randomizes the entire order of specimens or maintains the order within groups,
depending on the 'case_control' flag. It also allows for reproducible randomization using a fixed seed.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>case_control</code></td>
          <td>
                <code>Optional[bool]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If True, maintains group order (samples within a group are not shuffled).
If False, shuffles all samples regardless of group. If None, the behavior is determined based on 
the presence of a group index column.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>reproducible</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If True, uses a fixed seed for randomization to ensure reproducibility.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>



<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">study</span> <span class="o">=</span> <span class="n">Study</span><span class="p">(</span><span class="n">study_name</span><span class="o">=</span><span class="s2">&quot;Diabetes Study&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">study</span><span class="o">.</span><span class="n">load_specimen_records</span><span class="p">(</span><span class="s2">&quot;patients.csv&quot;</span><span class="p">,</span> <span class="n">sample_group_id_column</span><span class="o">=</span><span class="s2">&quot;GroupID&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">study</span><span class="o">.</span><span class="n">randomize_order</span><span class="p">(</span><span class="n">case_control</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">study</span><span class="o">.</span><span class="n">specimen_records_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># Example output showing randomized order within groups.</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>src/study.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">randomize_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">case_control</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">reproducible</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Randomizes the order of specimen records in the study, optionally maintaining group integrity.</span>

<span class="sd">    This method either randomizes the entire order of specimens or maintains the order within groups,</span>
<span class="sd">    depending on the &#39;case_control&#39; flag. It also allows for reproducible randomization using a fixed seed.</span>

<span class="sd">    Args:</span>
<span class="sd">        case_control (Optional[bool]): If True, maintains group order (samples within a group are not shuffled).</span>
<span class="sd">            If False, shuffles all samples regardless of group. If None, the behavior is determined based on </span>
<span class="sd">            the presence of a group index column.</span>
<span class="sd">        reproducible (bool): If True, uses a fixed seed for randomization to ensure reproducibility.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; study = Study(study_name=&quot;Diabetes Study&quot;)</span>
<span class="sd">        &gt;&gt;&gt; study.load_specimen_records(&quot;patients.csv&quot;, sample_group_id_column=&quot;GroupID&quot;)</span>
<span class="sd">        &gt;&gt;&gt; study.randomize_order(case_control=True)</span>
<span class="sd">        &gt;&gt;&gt; study.specimen_records_df.head(3)  # Example output showing randomized order within groups.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specimen_records_df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;There are no study records loaded. Use &#39;load_specimen_records&#39; method to import study records.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">case_control</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="p">:</span>
            <span class="n">case_control</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">case_control</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">specimen_records_df_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specimen_records_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">case_control</span><span class="p">:</span>
        <span class="n">column_with_group_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Randomly permuting group order (samples within group unchanged) using variable &#39;</span><span class="si">{</span><span class="n">column_with_group_index</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Creating multiindex dataframe&quot;</span><span class="p">)</span>
        <span class="n">specimen_records_df_copy</span> <span class="o">=</span> <span class="n">specimen_records_df_copy</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">column_with_group_index</span><span class="p">,</span> <span class="n">specimen_records_df_copy</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
        <span class="n">drop</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Randomly permuting sample order.&quot;</span><span class="p">)</span>
        <span class="n">specimen_records_df_copy</span> <span class="o">=</span> <span class="n">specimen_records_df_copy</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">specimen_records_df_copy</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">specimen_records_df_copy</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
        <span class="n">column_with_group_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span>


    <span class="n">group_IDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">specimen_records_df_copy</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

    <span class="c1"># Permute order in table</span>
    <span class="k">if</span> <span class="n">reproducible</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using a fixed seed to random number generator for reproducibility; </span><span class="se">\</span>
<span class="s2">            running this method will always give the same result.&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using class-determined seed </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_seed</span><span class="si">}</span><span class="s2"> for random number generator&quot;</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_seed</span><span class="p">)</span>

    <span class="n">permutation_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">group_IDs</span><span class="p">)</span>

    <span class="n">prev_index_str</span> <span class="o">=</span> <span class="s2">&quot;index_before_permutation&quot;</span>

    <span class="c1"># if multiple randomization rounds, remove old column = prev_index_str </span>
    <span class="k">if</span> <span class="n">prev_index_str</span> <span class="ow">in</span> <span class="n">specimen_records_df_copy</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">specimen_records_df_copy</span> <span class="o">=</span> <span class="n">specimen_records_df_copy</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">prev_index_str</span><span class="p">)</span>

    <span class="n">specimen_records_df_copy</span> <span class="o">=</span> <span class="n">specimen_records_df_copy</span> \
                                <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">permutation_order</span><span class="p">]</span>\
                                <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">column_with_group_index</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="n">drop</span><span class="p">)</span>\
                                <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">specimen_records_df_copy</span> <span class="o">=</span> <span class="n">specimen_records_df_copy</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;index_before_permutation&quot;</span><span class="p">})</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_N_permutations</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">specimen_records_df</span> <span class="o">=</span> <span class="n">specimen_records_df_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.study.Study.sort_records_within_groups" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">sort_records_within_groups</span><span class="p">(</span><span class="n">sortby_column</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Sorts specimen records within each group based on a specified column.</p>
<p>This method groups the specimen records by a predefined group index column and then sorts each group's records
based on the specified 'sortby_column'. The sorted groups are then concatenated back into the main DataFrame.
This is useful for organizing records in a manner that respects the grouping while ordering the records within each group.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>sortby_column</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The column name in the specimen records DataFrame to sort by within each group.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If no group column is defined in the Study instance.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">study</span> <span class="o">=</span> <span class="n">Study</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">study</span><span class="o">.</span><span class="n">load_specimen_records</span><span class="p">(</span><span class="s2">&quot;specimens.csv&quot;</span><span class="p">,</span> <span class="n">sample_group_id_column</span><span class="o">=</span><span class="s2">&quot;GroupID&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">study</span><span class="o">.</span><span class="n">sort_records_within_groups</span><span class="p">(</span><span class="s2">&quot;Age&quot;</span><span class="p">)</span>
<span class="go"># This will sort the specimen records within each group based on the &quot;Age&quot; column.</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>src/study.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sort_records_within_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sortby_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sorts specimen records within each group based on a specified column.</span>

<span class="sd">    This method groups the specimen records by a predefined group index column and then sorts each group&#39;s records</span>
<span class="sd">    based on the specified &#39;sortby_column&#39;. The sorted groups are then concatenated back into the main DataFrame.</span>
<span class="sd">    This is useful for organizing records in a manner that respects the grouping while ordering the records within each group.</span>

<span class="sd">    Args:</span>
<span class="sd">        sortby_column (str): The column name in the specimen records DataFrame to sort by within each group.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If no group column is defined in the Study instance.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; study = Study(...)</span>
<span class="sd">        &gt;&gt;&gt; study.load_specimen_records(&quot;specimens.csv&quot;, sample_group_id_column=&quot;GroupID&quot;)</span>
<span class="sd">        &gt;&gt;&gt; study.sort_records_within_groups(&quot;Age&quot;)</span>
<span class="sd">        # This will sort the specimen records within each group based on the &quot;Age&quot; column.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sorting samples within </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="si">}</span><span class="s2"> by </span><span class="si">{</span><span class="n">sortby_column</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Step 1: Group the DataFrame by &#39;group_ID&#39;</span>
        <span class="n">grouped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specimen_records_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="p">)</span>

        <span class="c1"># Step 2: Sort each group by the &#39;sortby_column&#39; column</span>
        <span class="n">sorted_groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">sortby_column</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped</span><span class="p">]</span>

        <span class="c1"># Step 3: Concatenate the sorted groups back into a single DataFrame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specimen_records_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">sorted_groups</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No group column defined: self._column_with_group_index: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_with_group_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.study.Study.to_dataframe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">to_dataframe</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Converts the data from all plates in the study into a single Pandas DataFrame.</p>
<p>This method iterates over each plate in the study and converts its data to a DataFrame. 
These DataFrames are then concatenated into a single DataFrame representing the entire study.</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>pd.DataFrame: A DataFrame containing data from all plates in the study.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">study</span> <span class="o">=</span> <span class="n">Study</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">study_df</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">study_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="go"># Displays the first few rows of the combined DataFrame for the study.</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>src/study.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts the data from all plates in the study into a single Pandas DataFrame.</span>

<span class="sd">    This method iterates over each plate in the study and converts its data to a DataFrame. </span>
<span class="sd">    These DataFrames are then concatenated into a single DataFrame representing the entire study.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: A DataFrame containing data from all plates in the study.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; study = Study(...)</span>
<span class="sd">        &gt;&gt;&gt; study_df = study.to_dataframe()</span>
<span class="sd">        &gt;&gt;&gt; study_df.head()</span>
<span class="sd">        # Displays the first few rows of the combined DataFrame for the study.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">plate</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plate</span><span class="o">.</span><span class="n">as_dataframe</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.study.Study.to_layout_figures" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">to_layout_figures</span><span class="p">(</span><span class="n">annotation_metadata_key</span><span class="p">,</span> <span class="n">color_metadata_key</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">folder_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plate_name</span><span class="o">=</span><span class="s1">&#39;Plate&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Creates and saves visual representations of each plate in the study as figures.</p>
<p>This method iterates over each plate in the study, generating a figure based on specified metadata keys
for annotation and coloring. The figures are saved in the specified file format in a designated folder.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>annotation_metadata_key</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The metadata key used for annotating elements in the figure.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>color_metadata_key</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The metadata key used for coloring elements in the figure.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>file_format</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The format in which to save the figures (default is 'pdf').</p>
            </div>
          </td>
          <td>
                <code>&#39;pdf&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>folder_path</code></td>
          <td>
                <code>Optional[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path to the folder where the figures will be saved. 
If None, the current working directory is used.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>plate_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A base name for the figure files.</p>
            </div>
          </td>
          <td>
                <code>&#39;Plate&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>**kwargs</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Additional keyword arguments passed to the <code>as_figure</code> method of each plate.</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>



<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">study</span> <span class="o">=</span> <span class="n">Study</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">study</span><span class="o">.</span><span class="n">to_layout_figures</span><span class="p">(</span><span class="n">annotation_metadata_key</span><span class="o">=</span><span class="s2">&quot;sample_id&quot;</span><span class="p">,</span>
<span class="go">                        color_metadata_key=&quot;status&quot;,</span>
<span class="go">                        file_format=&quot;png&quot;,</span>
<span class="go">                        folder_path=&quot;/path/to/figures&quot;,</span>
<span class="go">                        plate_name=&quot;study_plate&quot;)</span>
<span class="go"># This will create and save figures for each plate in the &#39;/path/to/figures&#39; directory,</span>
<span class="go"># with annotations and colorings based on &#39;sample_id&#39; and &#39;status&#39;.</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>src/study.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_layout_figures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">annotation_metadata_key</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                      <span class="n">color_metadata_key</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                    <span class="n">file_format</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pdf&quot;</span><span class="p">,</span>
                    <span class="n">folder_path</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">plate_name</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Plate&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates and saves visual representations of each plate in the study as figures.</span>

<span class="sd">    This method iterates over each plate in the study, generating a figure based on specified metadata keys</span>
<span class="sd">    for annotation and coloring. The figures are saved in the specified file format in a designated folder.</span>

<span class="sd">    Args:</span>
<span class="sd">        annotation_metadata_key (str): The metadata key used for annotating elements in the figure.</span>
<span class="sd">        color_metadata_key (str): The metadata key used for coloring elements in the figure.</span>
<span class="sd">        file_format (str, optional): The format in which to save the figures (default is &#39;pdf&#39;).</span>
<span class="sd">        folder_path (Optional[str]): The path to the folder where the figures will be saved. </span>
<span class="sd">            If None, the current working directory is used.</span>
<span class="sd">        plate_name (str, optional): A base name for the figure files.</span>
<span class="sd">        **kwargs: Additional keyword arguments passed to the `as_figure` method of each plate.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; study = Study(...)</span>
<span class="sd">        &gt;&gt;&gt; study.to_layout_figures(annotation_metadata_key=&quot;sample_id&quot;,</span>
<span class="sd">                                color_metadata_key=&quot;status&quot;,</span>
<span class="sd">                                file_format=&quot;png&quot;,</span>
<span class="sd">                                folder_path=&quot;/path/to/figures&quot;,</span>
<span class="sd">                                plate_name=&quot;study_plate&quot;)</span>
<span class="sd">        # This will create and save figures for each plate in the &#39;/path/to/figures&#39; directory,</span>
<span class="sd">        # with annotations and colorings based on &#39;sample_id&#39; and &#39;status&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">folder_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">folder_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">folder_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span>

    <span class="c1"># New folder path for &quot;layout_lists&quot;</span>
    <span class="n">new_folder_path</span> <span class="o">=</span> <span class="n">folder_path</span> <span class="o">/</span> <span class="s2">&quot;layout_figures&quot;</span>

    <span class="c1"># Create the &quot;layout_lists&quot; folder if it does not exist</span>
    <span class="n">new_folder_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">plate</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">plate_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">plate</span><span class="o">.</span><span class="n">plate_id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">annotation_metadata_key</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">color_metadata_key</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">file_format</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">new_folder_path</span> <span class="o">/</span> <span class="n">file_name</span>

        <span class="c1"># Define title        </span>
        <span class="n">title_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: Plate </span><span class="si">{</span><span class="n">plate</span><span class="o">.</span><span class="n">plate_id</span><span class="si">}</span><span class="s2">, showing </span><span class="si">{</span><span class="n">annotation_metadata_key</span><span class="si">}</span><span class="s2"> colored by </span><span class="si">{</span><span class="n">color_metadata_key</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plate</span><span class="o">.</span><span class="n">as_figure</span><span class="p">(</span><span class="n">annotation_metadata_key</span><span class="p">,</span> <span class="n">color_metadata_key</span><span class="p">,</span> <span class="n">title_str</span><span class="o">=</span><span class="n">title_str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving plate figure to </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.study.Study.to_layout_lists" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">to_layout_lists</span><span class="p">(</span><span class="n">metadata_keys</span><span class="o">=</span><span class="p">[],</span> <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="n">folder_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plate_name</span><span class="o">=</span><span class="s1">&#39;plate&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Exports the layout of each plate in the study to files in the specified format.</p>
<p>This method iterates over each plate in the study and exports its layout to a file. 
The files are saved in a specified format (CSV by default) and stored in a designated folder.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>metadata_keys</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of metadata keys to include in the exported files.</p>
            </div>
          </td>
          <td>
                <code>[]</code>
          </td>
        </tr>
        <tr>
          <td><code>file_format</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The file format for the exported layouts (e.g., 'csv').</p>
            </div>
          </td>
          <td>
                <code>&#39;csv&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>folder_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path to the folder where the layout files will be saved. 
If None, the current working directory is used.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>plate_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A base name for the layout files.</p>
            </div>
          </td>
          <td>
                <code>&#39;plate&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">study</span> <span class="o">=</span> <span class="n">Study</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">study</span><span class="o">.</span><span class="n">to_layout_lists</span><span class="p">(</span><span class="n">metadata_keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sample_type&quot;</span><span class="p">,</span> <span class="s2">&quot;concentration&quot;</span><span class="p">],</span> 
<span class="go">                        file_format=&quot;csv&quot;, </span>
<span class="go">                        folder_path=&quot;/path/to/layouts&quot;, </span>
<span class="go">                        plate_name=&quot;experiment_plate&quot;)</span>
<span class="go"># This will save layout files for each plate in the &#39;/path/to/layouts&#39; directory.</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>src/study.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_layout_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata_keys</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span> 
                <span class="n">file_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;csv&quot;</span><span class="p">,</span>
                <span class="n">folder_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">plate_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;plate&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exports the layout of each plate in the study to files in the specified format.</span>

<span class="sd">    This method iterates over each plate in the study and exports its layout to a file. </span>
<span class="sd">    The files are saved in a specified format (CSV by default) and stored in a designated folder.</span>

<span class="sd">    Args:</span>
<span class="sd">        metadata_keys (list, optional): A list of metadata keys to include in the exported files.</span>
<span class="sd">        file_format (str, optional): The file format for the exported layouts (e.g., &#39;csv&#39;).</span>
<span class="sd">        folder_path (str, optional): The path to the folder where the layout files will be saved. </span>
<span class="sd">            If None, the current working directory is used.</span>
<span class="sd">        plate_name (str, optional): A base name for the layout files.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; study = Study(...)</span>
<span class="sd">        &gt;&gt;&gt; study.to_layout_lists(metadata_keys=[&quot;sample_type&quot;, &quot;concentration&quot;], </span>
<span class="sd">                                file_format=&quot;csv&quot;, </span>
<span class="sd">                                folder_path=&quot;/path/to/layouts&quot;, </span>
<span class="sd">                                plate_name=&quot;experiment_plate&quot;)</span>
<span class="sd">        # This will save layout files for each plate in the &#39;/path/to/layouts&#39; directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">folder_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">folder_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">folder_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span>

    <span class="c1"># New folder path for &quot;layout_lists&quot;</span>
    <span class="n">new_folder_path</span> <span class="o">=</span> <span class="n">folder_path</span> <span class="o">/</span> <span class="s2">&quot;layout_lists&quot;</span>

    <span class="c1"># Create the &quot;layout_lists&quot; folder if it does not exist</span>
    <span class="n">new_folder_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">plate</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">plate_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">plate</span><span class="o">.</span><span class="n">plate_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># Update file path to include the new folder</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">new_folder_path</span> <span class="o">/</span> <span class="n">file_name</span>

        <span class="n">plate</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span>
                    <span class="n">file_format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                    <span class="n">metadata_keys</span><span class="o">=</span><span class="n">metadata_keys</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.c011b7c0.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.7389ff0e.min.js"></script>
      
    
  </body>
</html>